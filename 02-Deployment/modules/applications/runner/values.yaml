gitlabUrl: "https://gitlab.com/"
runnerRegistrationToken: ""

rbac:
  create: true
  clusterWideAccess: true
  rules:
    - apiGroups: [""]
      resources: ["namespaces", "pods", "pods/attach", "pods/exec", "pods/log", "services", "configmaps", "secrets", "serviceaccounts", "events"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["apps"]
      resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["networking.k8s.io"]
      resources: ["ingresses"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: ["batch"]
      resources: ["jobs", "cronjobs"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
    - apiGroups: [""]
      resources: ["pods/portforward"]
      verbs: ["create"]

serviceAccount:
  create: true
  name: gitlab-runner
  automountServiceAccountToken: true

runners:
  config: |
    concurrent = 4
    check_interval = 30
    
    [[runners]]
      name = "Kubernetes Runner"
      # Используем переменные, которые будут подставлены Helm
      url = "${GITLAB_URL}"
      token = "${RUNNER_REGISTRATION_TOKEN}"
      executor = "kubernetes"
      [runners.kubernetes]
        namespace = "gitlab-runner"
        image = "ubuntu:22.04"
        privileged = false
        poll_timeout = 600
        service_account = "gitlab-runner"
        helper_image = "gitlab/gitlab-runner-helper:x86_64-latest"
        helper_image_flavor = "ubuntu"
        [runners.kubernetes.init_permissions_container]
          enabled = false